---
- hosts: all
  vars:
    username: hexgnu
    hostname: ito
    email: matt@matthewkirk.com
    ruby_versions:
      - 2.4.1
    ssh_keygen_bits: 4096
    ssh_keygen_types:
      - ed25519
  vars_prompt:
    - name: "ssh_keygen_password"
      prompt: "What password do you want to use for ssh?"
  roles:
    - ssh
    - ruby
    - mysql
    # - elasticsearch
    # - percona
    # - pyenv
    # - maintenance
    # - phantomjs
    # - postgres
  become_method: sudo
  become: true
  tasks:  
    - hostname:
        name: ito.local

    # Someday revisit to implement better security for this.
    - service:
        name: sshd
        state: started

    - name: Install RPMFusion free
      tags: [personal]
      dnf:
        name: https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-26.noarch.rpm
        state: present

    - name: Install RPMFusion non free
      tags: [personal]
      dnf:
        name: https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-26.noarch.rpm
        state: present

    - name: Spotify fedora repo
      tags: [personal]
      yum_repository: 
        name: fedora-spotify
        description: Fedora specific build of spotify clients
        gpgcheck: yes
        baseurl: http://negativo17.org/repos/spotify/fedora-$releasever/$basearch/
        gpgkey: http://negativo17.org/repos/RPM-GPG-KEY-slaanesh

    - name: Install libraries with dnf
      dnf: name={{ item }} state=latest
      tags: [system]
      with_items:
        - ack
        - bzip2
        - bzip2-devel
        - bzip2-libs
        - chromium
        - cmake
        - colordiff
        - conky
        - direnv
        - dmenu
        - exfat-utils
        - feh
        - fuse-exfat
        - git
        - gnome-shell-extension-pomodoro
        - hddtemp
        - htop
        - i3
        - i3lock
        - i3status
        - libsqlite3x-devel
        - libxml2-devel
        - libxslt-devel
        - lm_sensors
        - memcached
        - mongodb
        - mongodb-server
        - openssl-devel
        - pv
        - readline-devel
        - redis
        - redshift
        - redshift-gtk
        - shutter
        - sqlite
        - sqlite-devel
        - tmate
        - tmux
        - transmission
        - vim-enhanced
        - xbacklight
        - xss-lock
        - xz
        - xz-devel
        - zlib-devel
    - name: Redis server start
      service:
        name: redis
        state: started

    - name: Install personal libraries
      dnf: name={{ item }} state=installed
      tags: [personal]
      with_items:
        - spotify-client

    - name: Check out dotfiles
      become: true
      become_user: hexgnu
      git:
        update: false
        repo: git@github.com:/hexgnu/dotfiles.git
        dest: /home/hexgnu/git/dotfiles

    - command: bin/dotfiles
      become: true 
      become_user: hexgnu
      args:
        chdir: /home/hexgnu/git/dotfiles
